
20230731-outline-madoka

*まどか物語をどう書くか

何をしようとしているか

述語論理で、「魔法少女まどか⭐︎マギカ」(以下では「まどか⭐︎マギカ」と書く。

- この後、「魔法少女まどか⭐︎マギカ」のネタバレを含みます。古いアニメなので大丈夫だとは思いますが、予習してから呼んでください。

述語論理は数学の理論や推論を表現するために発展し使われているが、数学以外の世界を表現しようとするとどうなるのかというのが興味の中心にある。

数学では、最初に抽象的に概念を定義して、それを具体的な数学の対象に適用するような話の進め方をするけれど、現実の世界については、そうでないような話も書きたくなる。

現実の世界について述語論理で書くのは、大変だしうまくいくのかは分からないけれど、フィクションの世界ならある程度できるような気がする。そして、フィクションの世界を書いていくことによって、現実の世界を書くときの課題も見えてくるのではないだろうか。

**準備
述語論理といっても、ここではLISPによる実装をたよりにしているので、こんな表現を使う。

***論理式
論理式はlispで処理するので、次の形のS式にする。

term        ::= constant | variable | (関数記号 term...)
literal     ::= (+|- 述語記号 term...)
clause      ::= (vars litral...)   ここで varsはvariablesのリスト
clause 集合 ::= (clause...)


これからは複数のclauseの集合の関係を考えるが、clauseの集合はΣで表し、Σの要素は真な論理式だと見なす。

***世界と記号の対応
「まどか⭐︎マギカ」の世界の何を書くかというと、基本的な設定や重要そうな概念を述語論理で書くとどうなるかを考えようと思う。

主に描きたいこととしては「魔法少女になる」ことや「魔女になること」および「願いを叶える」とか「死ぬ」である。それ以外の、たとえば「見滝原中学に在籍している」とか「転校する」とか「母親の職業」とか「恋人である」とかいう関係には触れない。

****人物
「記号」にはどんなものがあるかだが、まずは「人物」を表すものがほしい。

たとえば「まどか」とその友達の名前や「キュゥべえ」は欲しい。

定数が「まどか⭐︎マギカ」の世界で何を表すか、それがどう定義されるべきかを考える。
定数の「制約条件」のようなものだ。

「キュゥべえ」は特殊な存在である。

****関係
定数が定義されると、次はそれらの間の関係を書きたい。
たとえば、「友達である」とか「好きである」とかも書けるだろうが、ここでは考えない。

「魔法少女である」や「魔女である」について考えたい。これらはどのように定義できるだろうか。

「魔法少女である」には「契約する」とか「願いを叶える」が関係する。

「魔女である」には「ソウルジェムが濁る」条件があり、「ソウルジェム」の濁りは「グリーフシード」が関係してくる。


***世界の記述と変化
「世界」は先にも書いたが、論理式の集合とみなす。論理式はclauseの集合として書き、Σで表す。
「世界」というのは漠然としているが、Σで書かれた事柄が世界について、私が興味を抱いている断片であるということだ。

キュゥべえと契約することで魔法少女になるわけだが、この変化は、世界の変化であるという観点で書こうと思う

世界の変化は、Σに対して事実 φ_iを次々に追加していくこと。φがΣと矛盾することもありうる。

おそらく、矛盾する事実が追加された状態になることが「変化」になるのだろう。

これはつまり、魔法とアルゴリズムは同じように書けるということになる。


**人物

***まどか

定数「まどか」は、物語世界にの人物「まどか」を指し示すが、具体的にこのアニメでは何を示しているのだろうか。

まず、何か「人物」だったり「誰か」だったりと考えられるまとまりがなくてはならないだろう。
それがどう認識されるのか、定義されるのかは、フィクションなのであまりつきつめて考える必要がない。

そのうえで、「まどか」の制約条件を考えると、他のキャラクターがその子を「まどか」と呼んでいるということだろう。

アニメには「設定資料」というものがあるらしいが、それには、各キャラクターの絵と名前の対応が書かれている。それはキャラクターの定義と考えられるので、設定資料を参照して定義するという方法はありうる。

現実世界では、「設定資料」は存在しない。「小説」のようなフィクションでも、「設定資料」を小説と同時に提示はしない。だから、アニメだけからわかる情報で定義をするという方法は、現実世界を記述するときにとるべき立場だと思う。だからこちらで進めてゆく。

他の人物の定数(名前)「ほむら」「さやか」「恭介」「仁美」「まみ」「杏子」などなども同様に定義できるだろう。

他の属性で定義するとしたら「見滝原中学校の二年生で、両親と弟がいて、云々」という物語中で示されている関係による定義も考えられる。今の所、この文書で書きたい現象とは関係ないので、そのような定義はしない。

*** キュゥべえ

一方で、「キュゥべえ」はその名前が「キュゥべえ」自身によって述べられて、魔法少女の間に広がっているとか、魔法少女以外には「猫」のようにしか見えないとか、「インキュベーター」という種族に属しているとか、際立った特徴はあるが、それは「名前」という点では「まどか」たちと違わないのかもしれない。


** 関係

*** 魔法少女(1)

キュゥべえとの契約によって魔法少女が生まれ、魔法少女から魔女に変貌するという推移を書く。
少女の願いとそれが叶えられるという側面は「魔法少女(2)」で書く。

まず、魔法少女だという述語を使って、たとえばΣ_0={(-魔法少女だ さやか)} としたとき、

さやかがキュゥべえと契約することによって、次のように世界の記述Σが変化すると考える。

　　Σ_0={(-魔法少女だ さやか) → Σ_1 = {(+魔法少女だ さやか)}

Σ_0に単に(+魔法少女だ さやか)という事実を追加すると
(-魔法少女だ さやか)と(+魔法少女だ さやか)が矛盾する。この矛盾こそが、「願いを叶える」という
行為によって引き起こされた変化だと考える。

この矛盾は、Σ_1の段階ではさやかはもう「魔法少女」になっており、すでに事実ではなくなっている
(-魔法少女だ さやか)を除去すればよい。

現実世界を観察対象とする場合は、事実が必ずしも正しくないという可能性もあるので、このように
簡単に矛盾する古い論理式を除去すればよいとはならないだろう。
ここらへんがフィクションを対象とすることによる単純化になっている。


*** ソウルジェムとグリーフシード
****　魔女だ
述語「魔女だ」のアニメ中での制約条件は、
　「キュゥべえと魔法少女がそう呼ぶなにか」ということだろう。
　普通の人間には自然現象としか見えないということなので、キュゥべえの定義と同じく、限定されたキャラクターによってどう呼ばれているかという条件になる。

**** ソウルジェム
魔法少女は魔女になるが、その時の重要な属性が「ソウルジェム」である。
魔法少女の日々の生活の中で、精神的な穢れがでるとソウルジェムが濁る。
この「精神的な云々」は論理式で表現できなさそうなので、ここでは扱わない。

濁りを[0:10]の数値で表すことにして、ソウルジェムの濁りを(ソウルジェム who)であらわし
 ((who) (- >= (ソウルジェム who) 10) (-魔法少女だ who) (+魔女だ who))
みたいなルールが書ける

Σ_0で (- >= (ソウルジェム who) 10)であり(+魔法少女だ who)が真であったとして
日常生活のイベントてして

  (ソウルジェム who)++

が発生する仕組みはどう作れるのだろうか?

また、ソウルジェムが魔法少女の魂であることは、ここで考えようとしていることと関係しないので取り上げない。
ただ、書くとしたら、「死んでいる」ことや魂の所在などの関係を書く必要がありそうな気はする。
もっと簡単に書けるのかもしれない。


**** 魔法少女と魔女の戦い
キュゥべえははっきりと言っていないようだが、まみは「魔女を倒すために魔法少女になる」ようにとまどかやさやかに言っている。

魔法少女が魔女を倒さなくてはならないのかどうかは明確ではないが、アニメでは魔法少女と魔女は戦っている。

この魔法少女の戦いはどう表現できるだろうか。これが難しい。

「戦う」とか「戦い」自体は、結果が決まっていない行動なので、Σ_0からΣ_1への変化ではとらえきれないと思う。

戦いの結果が決まったら、それをΣを使って書くことはできる。

「戦い」というのは「プログラム」と同じく、実際の行動(計算)の過程を表現にしたうえで重ね合わせたもののようだ。

フィクションのストーリーを描くのであれば、そのような概念はいらない。

設定を描く場合、そのような概念が必要になると思う。


**** グリーフシード
魔女を倒すとグリーフシードが得られる。

倒す前の魔女の状態がわからないので確実ではないが、グリーフシードは魔女の所有物と考えればよいのだろうか。

しかし、所有物だと考えると、「魔法少女が魔女を倒す」、「魔法少女が魔女の所有物を取る」、「魔法少女が所有物であるグリーフシードとソウルジェムを重ねる」、「ソウルジェムの穢れが消える」
といった一連の操作を書かなくてはならなくなる。

なにか違うような気がする。



*** 魔法少女(2)
キュゥべえあるいはインキュベーターは、魔法少女の契約に従って、少女の願いを叶える。
この部分は「魔法少女になる」ということよりも大きな変化を世界に及ぼす。

アニメでは、魔法少女になるシーンはリアルタイムではさやかとまどかしか描かれておらず、まみと杏子、ほむらについては回想の中で描かれるだけだ。だが、ストーリーとしての順序は、
その願いの影響度が次第に大きくなるように描かれている。順を追って、「願い」を表現してみる。

**** 願いが叶う

whoがwishを願うことを(+願った who wish)と書くとする。

願いが叶うとは
((who wish) (-願った who wish) wish)

と書ける。項であるwishがリテラルに昇格しているので、これはもう一階述語ではない。

あえて、

((who wish) (-願った who wish) (事実 wish))

というような述語もどきを持ち込んだとしても「事実」の正体ははっきりしない。


**** さやかの願い
さやかの願いは、「恭平の腕の怪我を治す」だった。
背景として
・医者はこの怪我を治せない
・怪我のためにバイオリンの演奏でがきない
・恭介はバイオリンの才能がある
ということがあるが、ここでは

さ-1) (() (+怪我をしている 恭介))
さ-2) (who) (-怪我をしている who)(-演奏ができる who)
という情報があり、これから
()(-演奏ができない 恭介)

という事実が導かれて、恭介が苦しんでいるのをさやかは見ていられない。
という状況だろう。

これに対してさやかの願いは
さ-3) (-怪我をしていない 恭介)
が真となることである。

つまり願いが叶うことにより

Σ_0={さ-1、さ-2}
Σ_0'={さ-1、さ-2、さ-3}
となり、矛盾を解消してさ-1が消え、さ-3が残るので
Σ_1={((-怪我をしている 恭介)), ((who) (-怪我をしている who)(-演奏ができる who))}となる

これからは恭介が演奏できるという事実は出てこないのだが
さ-2と同時に前提として
さ-4) ((who) (+怪我をしている who)(+演奏ができる who)
が事実/ルールとして存在していたと考えれば、さ-4とさ-3から(+演奏ができる 恭介)が導かれる。

***** このような暗黙のルールをどう考えればよいのか
たとえば「怪我をしている」という述語は、願いと関連して、ここで登場するしかなかった。

もしもそのような関連がなければ、「怪我をしている」も不要だし「健康である」も不要だっただろう。

ということは、世界を記述していく上で、何か概念が必要になったら、それに関するルールとか制約条件も
生まれなくてはならないようだ。

★ 定義は必要に応じて発生するのかもしれない。


**** まみの願い
まみの願いはよく覚えていないが、交通事故で死にそうになったときは生き延びたいとかいうものではなかっただろうか。
これは確定した未来に対する事実の変更とも考えられる。
さやかの願いの「恭介の怪我を治す」も、「医者には治せないから、治らない怪我を治す」というように確定した未来の変更だった。

怪我は目の前にあったが、「死」はまだ訪れていないという違いがある。

まだ起こっていないことをΣ_0に書くのはおかしいので、書くとしたら「まみの怪我を治す」という願いになるのだろう。

★まだ起きていないことをないことにする願いとは


**** 杏子の願い
杏子の願いは、正確には覚えていないが、父親の信者が父親を信じるようにすることであったと思う。
これを論理式で書くのは

((who) (-信者である who (父 杏子)) (+信じる who (父 杏子) )

みたいな願いになるだろう。先の「願った」述語を使うとこのように書ける。

(+願った 杏子 ((who) (-信者である who (父 杏子)) (+信じる who (父 杏子) )


**** ほむらの願い
ほむらの願いはかなり問題が含まれていて、キュゥべえが何故その願いを叶えたのか、または叶えられたのかはよくわからない。

時間を遡る願いを叶えることによって、その願いの効果をインキュベーター自身が監視できなくなる。
それを気にしないということは、インキュベーターは、宇宙を存続させることに特化されたプログラムであることなのだろう。
ある意味、宇宙のバグなのかもしれない。

***** 過去への遡行
ほむらの願いは「鹿目さんとの出会いをやり直したい」である。

これを表現するには、ストーリーの遷移に応じたΣの系列Σ_iを考えなくてはならない。
出会いの世界をΣ_0としたとき、最初のまどかの死にいたる系列
　Σ_0, Σ_1,...., Σ_k
があり、Σ_kでほむらがキュゥべいと契約したとすると
　ほむらはΣ_0から別のΣ_1'への遷移を選ぶことになる。

　それだけでなく、ほむらの内心では、Σ_0からΣ_kにいたるすべての経験が残っている。
　これをΣ^ほ_(1,0), Σ^ほ_(1,1), ..., Σ^ほ_(1,k) と書くとすると
　Σ_0に戻ってからの第二の系列をΣ_0, Σ_(2,1), Σ_(2,2), ..., Σ_(2,m)では
　ほむらの内心は
　Σ^ほ_(1,0), Σ^ほ_(1,1), ..., Σ^ほ_(1,k), Σ^ほ_(2,1),Σ^ほ_(2,2),..., Σ^ほ_(2,m)

となる。

　これは単にストーリーの内容を直截的に書き直しただけ。

　ちなみに、Σ^ほ_(1,0)とΣ^ほ_(2,0)は二つの点で同じではないので表現を変えている。
　1) その世界におけるほむらの内心が異なる
　2) アニメを見ると、初回のまどかは魔法少女だが、アニメの段階ではまどかは魔法少女になっていない。
　　だから、ほむらの戻った世界は前回通った世界とは異なることがわかる。

アニメでは、この繊維が繰り返される。

(1回のループが1ヶ月として、500回のループで40年程度になるので、ほむらは見かけと違って精神的にはかなり歳をとっている)。

(μφ{Σ_i}で条件φを満たすΣ_iの中の一番古いものを選ぶとすると(複数ある場合はその中から適当に選ぶ)、

　Σ_(p,0) = μ(+ 出会った ほむら まどか) ∪_(q<p){Σ_(q,0)}

と表すこともできるだろう。

***** ほむらの不変条件

ほむらが時間を遡行するたびに経験だけは蓄積されていくが、それでも普遍な条件がほむらを特徴づけるのではないだろうか。その普遍条件は次のように表現できる。

Σ^ほ_(p+1,t) = Σ^ほ_(p,t_p) + (Σ^ほ_(p,s) - Σ^ほ_(p,t_p))

t_pはほむらがもどる時刻
sは、p回目のほむらが、過去に戻る願いをキュゥべえに言う時刻。
pは、何回目の遡行かを示す

右辺は、前回の遡行点(t_p)から、戻る直前の時刻(s_p)までの間の経験を
 (Σ^ほ_(p,s) - Σ^ほ_(p,t_p))
と表し、Σ^ほ_(p+1,t^p+1)からの経験にそれを加えている。

先にも書いたが、前回の開始時点Σ^ほ_(t^p) と今回の開始時点Σ^ほ_(t^(p+1)) はまったく同じではないことに注意。
ほむらが「ことば」で望んだことがらは実際に叶えられる時、ことなる遡行時刻になっている。
それは、ほむらがストーリーを書き換えているというからなのかもしれないが、ほむらは戻った時点より後に起きた
ことしか変えていないのに、出発時点の状態が変わるのは辻褄が合わない。

ここでは、その出発時点の世界がΣ^ほ_(t^p) とΣ^ほ_(t^(p+1)) で異なっていてもよいという書き方をした。


★ほむらは何回キュゥべえと契約しているのか。何故それが可能なのか。



*** まどかの願い
まどかの願いは、「過去、現在、未来、全宇宙に存在する全ての魔女を、生まれる前に自分の手で消し去ること」であった。

この願いの実現を表現するためには、Σに関する幾つかの概念が必要になる。

**** 仕掛け
すべてのΣの集合を{Σ_*}と書くことにする。

ほむらが回帰することによって、Σ_(p,0)から始まるp個のシーケンスがある。
1つのシーケンス上のΣの数は厳密には数えられないのと、異なるシーケンス上のΣの個数は同じではないので、

ほむらが時を戻らなければ、{Σ_*}には1つのシーケンスしか含まれない。

{Σ_*}は、「過去、現在、未来、全宇宙」の状態を記述するΣから構成される。


まどかの願いは次のように書ける。ここではclauseでなく、一般的な論理式で表すことにする。

(∀who μ(+(-魔法少女だ who)(+魔女だ who) {Σ_*} についてまどかが{魔女を消し去る}という行為をするのだが、その方法はわからない。

これによってすべてのΣ∋((-魔法少女だ who)(+魔女だ who)}について
Σ'=Σ-((-魔法少女だ who)(+魔女だ who)}という世界になる。

★ふしぎなのは、まどかがすべての魔女について、生まれる前に自分の手で消し去る」という望みが、まどか自身の積極的な関与を望んでいる点だ。


**** エネルギー収支
インキュベーターの目的
>>
宇宙の寿命を延ばすことにあり、魔法少女たちが希望から絶望へ相転移して魔女となる際に、その感情が熱力学第二法則に縛られない莫大なエネルギーを発生させるため、そのエネルギーを搾取する
<<
(Wikipedia/「魔法少女まどか⭐︎まぎか」から引用)

であるとすると、魔法少女の望みを叶えるために必要なエネルギーが、その魔法少女が魔女になる際に発生するエネルギーよりも十分に小さくなくては、インキュベーターの行動に正当性がない。

ほむらの望みの実現にどれだけエネルギーが必要なのかの見積もりすら難しいが、それによって蓄積される潜在的な魔法エネルギーが、まどかに蓄積されるかどうかはともかく、たとえばほむらが魔女になったときに発生するエネルギーが相当巨大なものになりそうなことは、キュゥべえにも見積もれたのではないかと思う。
だから、ほむらについては納得できる。

そこで、まどかの願いについてのエネルギー収支の計算をしておきたい。

すべての魔女の発生を消し去るためには、次の3つの思い計算が必要になる。
{Σ_*}の数をNとする。

1) すべての魔女について、魔女の存在する一番古いΣを発見する。(N回のΣ内の論理式の検索)
2) その魔女が発生する直前((-魔法少女だ who)(+魔女だ who))のΣ_tを求める。(Σの長さをMとすると、M回の検索)
3) まどかによってその魔女の発生条件を消滅させる。これに必要な計算量は不明だが、Kとする。

以上から、全体の必要な計算量は

　E = N*M*K

である。

まどかの願いをかなえるためのインキュベーターの消費するエネルギーΕとすると。

　Ε < N*M*K

でなくてはならない。

なかなか収支はあわないようにも見える。
