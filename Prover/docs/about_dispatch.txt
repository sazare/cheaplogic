method dispatchをどこまで使えるか。 20190324

1. clause, literal(atom), term, constant, Number によるmethod dispatch
のコードをある程度書いている。
2.  一方で、関数名を違わせて、明示的に型をわけているものもある。
3.  ひとつの関数で、引数の型で場合分けをするのはほとんどないと思う。


1が他の方法と違う点は、場合分けをユーザーコードでなく
計算システムにまかせるという点で、コンパイラが高速な
コードを誠意せしてくれることを期待しているのだと思う。

これが使えるのは、データ構造が完全に型で決まっている必要がある。

中途半端に型を使っていると、たとえばAnyの部分は自分で判定して
場合分けをする必要がでてくる。

cheaplogicとkplogicのように、pluginのような形で処理を入れ替えたい時
(kplogicではliteralの部分の処理を入れ替えている。つまり、clauseと
termの処理は共有できるかもしれないということ)には、その入れ替える
部分を縛るためにinterfaceを定義するとよいだろうが、
interfaceを定義できるほど、はっきりわかっていない場合はかえって
難しくなると思う。

その時点で、もっとも一般的なinterfaceを定義するという手もあるが
あとでrefactoringが必要になるだろう。

そのときの気分で選ぶしかない。




